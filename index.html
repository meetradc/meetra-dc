<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Meetra.to | meet • real • now</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

<style>
/* --- existing styles unchanged --- */
:root{
  --primary:#3259e8;
  --dark:#0f172a;
  --muted:#64748b;
  --border:#e5e7eb;
}

body{margin:0;font-family:system-ui;color:var(--dark)}
.container{max-width:1100px;margin:auto;padding:24px}
button{border:none;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
.primary{background:var(--primary);color:white}
.exit{background:white;border:1px solid var(--border);color:#991b1b}

.user{display:flex;justify-content:space-between;align-items:center;
  padding:10px;border-radius:12px;border:1px solid var(--border);margin-bottom:8px}
.match{border:2px solid var(--primary);background:#f0f4ff}
.pending{background:#9ca3af;color:white}
.confirm{background:#16a34a;color:white}
.locked{background:#065f46;color:white;padding:6px 10px;border-radius:8px}

.venue{display:flex;justify-content:space-between;align-items:center;
  border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px}

.top-bar{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:12px
}
</style>
</head>

<body>

<header class="container" style="text-align:center">
  <div style="font-size:2.6rem;font-weight:900">
    Meetra<span style="color:#3259e8">.to</span>
  </div>
  <div style="color:#64748b">meet • real • now</div>

  <h1>Stop scrolling.<br>Start meeting.</h1>
</header>

<div class="container">

<!-- JOIN -->
<section id="joinCard">
  <input id="nameInput" placeholder="Your name">
  <input id="interestInput" placeholder="Interest (coffee, dog walk)">
  <label style="font-size:.9rem;color:#64748b">
    <input type="checkbox" id="demoToggle"> Demo Mode (sample users)
  </label>
  <br><br>
  <button class="primary" onclick="joinLobby()">Enter Lobby</button>
</section>

<!-- LOBBY -->
<section id="lobby" style="display:none">
  <div class="top-bar">
    <h3>Live Matches</h3>
    <button class="exit" onclick="exitLobby()">Exit</button>
  </div>

  <div id="userList"></div>

  <div id="venuesSection" style="display:none">
    <h3>Choose a Public Venue</h3>
    <div id="venueList"></div>
  </div>
</section>

</div>

<script>
/* ---------- SUPABASE ---------- */
const supabaseClient = supabase.createClient(
  'https://ggirvskmmgeegjhstiqe.supabase.co',
  'sb_publishable_2iQ5bRLoZa9rlmk2m67tMw_5cgYW5H9'
);

let MY_ID, MY_INTEREST, MATCH_ID;
let DEMO=false;

/* ---------- DEMO USERS ---------- */
const DEMO_USERS = [
  {id:101,username:'Alex',interest:'coffee'},
  {id:102,username:'Priya',interest:'coffee'},
  {id:103,username:'Sam',interest:'dog walk'}
];

/* ---------- JOIN ---------- */
function joinLobby(){
  const name=nameInput.value.trim();
  const interest=interestInput.value.trim().toLowerCase();
  DEMO=demoToggle.checked;

  if(!name||!interest) return alert('Enter name and interest');

  MY_INTEREST=interest;
  MY_ID=999;

  joinCard.style.display='none';
  lobby.style.display='block';

  loadLobby();
}

/* ---------- EXIT ---------- */
function exitLobby(){
  location.reload();
}

/* ---------- LOBBY ---------- */
async function loadLobby(){
  userList.innerHTML='';
  const people = DEMO ? DEMO_USERS : (await supabaseClient.from('profiles').select('*')).data;

  people.forEach(p=>{
    if(p.interest!==MY_INTEREST) return;

    const div=document.createElement('div');
    div.className='user match';

    div.innerHTML=`
      <strong>${p.username}</strong>
      <button onclick="confirmMatch(${p.id})">Let’s Meet</button>
    `;
    userList.appendChild(div);
  });
}

/* ---------- CONFIRM ---------- */
function confirmMatch(id){
  MATCH_ID=id;
  venuesSection.style.display='block';
  loadVenues();
}

/* ---------- VENUES ---------- */
async function loadVenues(){
  const venues = DEMO
    ? [
        {id:1,name:'Blue Bottle Coffee',address:'DC'},
        {id:2,name:'Dumbarton Oaks Park',address:'Georgetown'}
      ]
    : (await supabaseClient.from('venues').select('*')).data;

  venueList.innerHTML='';

  venues.forEach(v=>{
    const div=document.createElement('div');
    div.className='venue';
    div.innerHTML=`
      <div><strong>${v.name}</strong><br><small>${v.address}</small></div>
      <span class="locked">Meeting Set</span>
    `;
    venueList.appendChild(div);
  });
}
</script>

</body>
</html>
