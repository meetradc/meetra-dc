<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetra-to | Stop Scrolling, Start Meeting</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --blue: #3259e8; --dark: #1a202c; --gray: #f8f9fa; --spacing: 60px; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; color: var(--dark); background: white; -webkit-font-smoothing: antialiased; }
        .container { max-width: 1140px; margin: 0 auto; padding: 0 30px; }
        header { padding: 20px 0; border-bottom: 1px solid #eee; }
        .logo { font-size: 1.4rem; font-weight: 800; }
        .logo span { color: var(--blue); }
        
        .hero { display: flex; align-items: flex-start; justify-content: space-between; padding: var(--spacing) 0; gap: 40px; }
        .hero-text { flex: 1; }
        .hero-form { flex: 1; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        
        h1 { font-size: 2.8rem; line-height: 1.1; margin-bottom: 15px; font-weight: 800; }
        h1 span { color: var(--blue); }
        
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; }
        .btn-broadcast { width: 100%; background: var(--blue); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 700; cursor: pointer; }

        /* Match & Venue UI */
        .lobby-section { margin-top: 30px; }
        .attendee-card { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .match-highlight { border: 2px solid var(--blue); background: #f0f4ff; }
        
        #venue-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; display: none; }
        .venue-card { border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: white; }
        .venue-card img { width: 100%; height: 100px; object-fit: cover; }
        .venue-info { padding: 10px; font-size: 0.85rem; }

        @media (max-width: 850px) { .hero { flex-direction: column; } }
    </style>
</head>
<body>

    <header><div class="container"><div class="logo">Meetra<span>-to</span></div></div></header>

    <div class="container">
        <section class="hero">
            <div class="hero-text">
                <h1>Stop Scrolling.<br><span>Start Meeting.</span></h1>
                <p>Turning shared interests into real-world hangouts at verified spots.</p>
                
                <div id="venue-section">
                    <h3 id="venue-title" style="display:none;">Verified Meeting Spots:</h3>
                    <div id="venue-grid"></div>
                </div>
            </div>

            <div class="hero-form">
                <h3>DC Live Lobby</h3>
                <form id="lobby-form">
                    <input type="text" id="user-name" placeholder="Your Name" required>
                    <input type="text" id="user-interest" placeholder="Interest (e.g. Chess, Tech)" required>
                    <button type="submit" class="btn-broadcast">Broadcast Presence</button>
                </form>

                <div class="lobby-section">
                    <p style="font-weight:bold; font-size:0.9rem;">Live Lobby:</p>
                    <div id="attendee-list"></div>
                </div>
            </div>
        </section>
    </div>

    <script>
        const SUPABASE_URL = 'https://ggirvskmmgeegjhstiqe.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnaXJ2c2ttbWdlZWdqaHN0aXFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NTUxMjMsImV4cCI6MjA4MjUzMTEyM30.8CSk0hPFxvniwk2FGhZoZWsL92JMNpAs2Ry9nid_dG4';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const form = document.getElementById('lobby-form');
        const attendeeList = document.getElementById('attendee-list');
        const venueGrid = document.getElementById('venue-grid');
        const venueTitle = document.getElementById('venue-title');

        async function fetchVenues() {
            const { data, error } = await _supabase.from('venues').select('*').limit(4);
            if (data) {
                venueTitle.style.display = 'block';
                venueGrid.style.display = 'grid';
                venueGrid.innerHTML = data.map(v => `
                    <div class="venue-card">
                        <img src="${v.image_url}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="venue-info">
                            <strong>${v.name}</strong><br>
                            <small>${v.address}</small>
                        </div>
                    </div>
                `).join('');
            }
        }

        async function fetchLobby(myInterest = "") {
            const { data, error } = await _supabase.from('profiles').select('*').order('created_at', { ascending: false });
            if (data) {
                attendeeList.innerHTML = data.map(p => {
                    const isMatch = myInterest && p.interest.toLowerCase().includes(myInterest.toLowerCase());
                    return `
                        <div class="attendee-card ${isMatch ? 'match-highlight' : ''}">
                            <div><strong>${p.username || p.name}</strong><br><small>${p.interest}</small></div>
                            ${isMatch ? '<span style="color:var(--blue); font-weight:bold;">Match!</span>' : ''}
                        </div>
                    `;
                }).join('');
                if (myInterest) fetchVenues();
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('user-name').value;
            const interest = document.getElementById('user-interest').value;
            await _supabase.from('profiles').insert([{ username: name, interest: interest }]);
            form.reset();
            fetchLobby(interest);
        });

        fetchLobby();
    </script>
</body>
</html>
